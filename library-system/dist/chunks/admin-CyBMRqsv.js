import{F as c,T as I,C as b,a as y,B as j,b as m,M as p,I as f,c as K,s as r}from"./antd-DC2I45J9.js";import{r as l,j as e,R as _,a as L,b as P,c as O,d as a}from"./vendor-BGZrXFKf.js";const o="http://localhost:3000",{TabPane:k}=I;function J(){const[Q,B]=l.useState("1"),[d]=c.useForm(),[g,i]=l.useState(!1),[h,n]=l.useState(!1),[S,v]=l.useState([]),[R,$]=l.useState([]),[A,F]=l.useState([]),[z,D]=l.useState({totalBooks:0,activeUsers:0,activeBorrows:0}),C=async()=>{try{const[t,s,x]=await Promise.all([a.get(`${o}/books`),a.get(`${o}/users`),a.get(`${o}/borrow`)]);D({totalBooks:t.data.length,activeUsers:s.data.length,activeBorrows:x.data.length})}catch{r.error("Failed to fetch statistics")}},u=async()=>{n(!0);try{const t=await a.get(`${o}/books`);v(t.data)}catch{r.error("Failed to fetch book data")}finally{n(!1)}},w=async()=>{n(!0);try{const t=await a.get(`${o}/users`);$(t.data)}catch{r.error("Failed to fetch user data")}finally{n(!1)}},U=async()=>{n(!0);try{const t=await a.get(`${o}/borrow`);F(t.data)}catch{r.error("Failed to fetch borrow records")}finally{n(!1)}};l.useEffect(()=>{C(),u(),w(),U()},[]);const T=[{title:"Title",dataIndex:"title",sorter:(t,s)=>t.title.localeCompare(s.title)},{title:"Author",dataIndex:"author"},{title:"ISBN",dataIndex:"isbn"},{title:"Stock",dataIndex:"available_copies",render:t=>e.jsx(m,{color:t>0?"green":"red",children:t})},{title:"Actions",render:(t,s)=>e.jsxs("div",{children:[e.jsx(j,{type:"link",onClick:()=>N(s),children:"Edit"}),e.jsx(j,{type:"link",danger:!0,onClick:()=>E(s.id),children:"Delete"})]})}],M=async t=>{try{await a.post(`${o}/books`,t),r.success("Book added successfully"),u(),i(!1),d.resetFields()}catch{r.error("Failed to add book")}},E=async t=>{try{await a.delete(`${o}/books/${t}`),r.success("Deleted successfully"),u()}catch{r.error("Failed to delete")}},N=async(t,s)=>{try{await a.put(`${o}/books/${s}`,t),r.success("Updated successfully"),u(),i(!1)}catch{r.error("Failed to update")}},q=async(t,s)=>{try{await a.put(`${o}/users/${t}`,{role:s}),r.success("Role updated successfully"),w()}catch{r.error("Failed to update role")}};return e.jsxs("div",{style:{padding:24},children:[e.jsxs(I,{defaultActiveKey:"1",onChange:B,children:[e.jsx(k,{tab:e.jsxs("span",{children:[e.jsx(L,{}),"Book Management"]}),children:e.jsx(b,{title:"Book List",extra:e.jsx(j,{type:"primary",icon:e.jsx(_,{}),onClick:()=>i(!0),children:"Add New Book"}),children:e.jsx(y,{columns:T,dataSource:S,rowKey:"id",loading:h,bordered:!0})})},"1"),e.jsx(k,{tab:e.jsxs("span",{children:[e.jsx(P,{}),"User Management"]}),children:e.jsx(b,{title:"User List",children:e.jsx(y,{columns:[{title:"Username",dataIndex:"username"},{title:"Role",dataIndex:"role",render:(t,s)=>e.jsx(m,{color:t==="admin"?"gold":"blue",onClick:()=>{p.confirm({title:"Change User Role",content:`Are you sure you want to change ${s.username}'s role?`,onOk:()=>q(s.id,t==="admin"?"user":"admin")})},children:t})},{title:"Registration Date",dataIndex:"registered"}],dataSource:R,rowKey:"id",loading:h,bordered:!0})})},"2"),e.jsx(k,{tab:e.jsxs("span",{children:[e.jsx(O,{}),"Borrow Records"]}),children:e.jsx(b,{title:"All Borrow Records",children:e.jsx(y,{columns:[{title:"User",dataIndex:["user","username"]},{title:"Book",dataIndex:["book","title"]},{title:"Borrow Date",dataIndex:"borrowDate"},{title:"Due Date",dataIndex:"dueDate",render:t=>e.jsx("span",{style:{color:new Date(t)<new Date?"red":"inherit"},children:t})},{title:"Status",dataIndex:"status",render:t=>e.jsx(m,{color:t==="active"?"green":"volcano",children:t==="active"?"Active":"Returned"})}],dataSource:A,rowKey:"id",loading:h,bordered:!0})})},"3")]}),e.jsx(p,{title:"Add New Book",visible:g,onOk:()=>d.submit(),onCancel:()=>{i(!1),d.resetFields()},children:e.jsxs(c,{form:d,layout:"vertical",onFinish:M,children:[e.jsx(c.Item,{label:"Title",name:"title",rules:[{required:!0}],children:e.jsx(f,{})}),e.jsx(c.Item,{label:"Author",name:"author",rules:[{required:!0}],children:e.jsx(f,{})}),e.jsx(c.Item,{label:"ISBN",name:"isbn",rules:[{required:!0}],children:e.jsx(f,{})}),e.jsx(c.Item,{label:"Stock Quantity",name:"available_copies",rules:[{required:!0,type:"number",min:0}],children:e.jsx(K,{style:{width:"100%"}})})]})})]})}export{J as A};
