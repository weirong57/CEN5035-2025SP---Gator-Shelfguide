import{r as d,bu as P,j as e,b as I,au as Z,bv as G,bw as V,a as L,c as X,bx as ee,by as te,d as k,a6 as se,ay as re,bd as ae,bz as oe,bA as ne,bB as p,bC as T,bD as ie,h as le,bE as ce}from"../chunks/vendor-BGZrXFKf.js";import{L as B,D as de,S as ue,A as K,d as he,e as ge,I as U,a as Y,s as j,B as N,M as J,f as me,g as Q,C as S,b as v,F as R,R as F,h as $,i as xe,j as W,k as H,l as E}from"../chunks/antd-DC2I45J9.js";import{A as pe}from"../chunks/admin-CyBMRqsv.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function c(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=c(i);fetch(i.href,l)}})();const je=()=>{const[r,a]=d.useState(""),[c,o]=d.useState(""),i=P(),l=h=>{if(h.preventDefault(),!r.trim()||!c.trim()){alert("Please enter your username and password.");return}console.log("Username login:",r,c),localStorage.setItem("isLoggedIn","true"),i("/main/dashboard")},u=()=>{i("/signup")},m=h=>{console.log(`Login with ${h}`)};return e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-container",children:[e.jsx("div",{className:"login-left",children:e.jsxs("div",{className:"left-content",children:[e.jsx("div",{className:"logo",children:"Gator Shelfguide"}),e.jsx("p",{children:"Login using social networks"}),e.jsxs("div",{className:"social-login",children:[e.jsx("button",{className:"social-button",onClick:()=>m("Gmail"),children:e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/4/4e/Gmail_Icon.png",alt:"Gmail",width:"20",height:"20"})}),e.jsx("button",{className:"social-button",onClick:()=>m("Outlook"),children:e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/7/76/Microsoft_Office_Outlook_%282018%E2%80%93present%29.svg",alt:"Outlook",width:"20",height:"20"})})]}),e.jsx("div",{className:"or-divider",children:"OR"}),e.jsxs("form",{className:"login-form",onSubmit:l,children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{id:"username",type:"text",placeholder:"Enter your username",value:r,onChange:h=>a(h.target.value)}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{id:"password",type:"password",placeholder:"Enter your password",value:c,onChange:h=>o(h.target.value)}),e.jsx("button",{type:"submit",children:"Login"})]})]})}),e.jsx("div",{className:"login-right",children:e.jsxs("div",{className:"signup-box",children:[e.jsx("h2",{children:"New Here?"}),e.jsx("p",{children:"Sign up and discover the Elibrary!"}),e.jsx("button",{onClick:u,children:"Sign Up"})]})})]})})},fe=()=>{const r=P(),[a,c]=d.useState(""),[o,i]=d.useState(""),[l,u]=d.useState(""),[m,h]=d.useState(""),w=async g=>{if(g.preventDefault(),!a||!o||!l){h("Please fill in all fields.");return}if(o!==l){h("Passwords do not match.");return}try{const n=await fetch("http://localhost:3000/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:o,role:"user"})});if(!n.ok){const s=await n.text();h(s);return}const t=await n.json();alert(t.message),r("/login")}catch(n){console.error(n),h("Something went wrong. Please try again.")}};return e.jsx("div",{className:"signup-page",children:e.jsxs("div",{className:"signup-container",children:[e.jsxs("div",{className:"signup-left",children:[e.jsx("h2",{children:"Create Your Account"}),e.jsx("p",{children:"Join Gator Shelfguide for a seamless library management experience."}),m&&e.jsx("div",{className:"error",children:m}),e.jsxs("form",{onSubmit:w,children:[e.jsx("input",{type:"text",placeholder:"Username",value:a,onChange:g=>c(g.target.value),required:!0}),e.jsx("input",{type:"password",placeholder:"Create a Password",value:o,onChange:g=>i(g.target.value),required:!0}),e.jsx("input",{type:"password",placeholder:"Confirm Password",value:l,onChange:g=>u(g.target.value),required:!0}),e.jsx("button",{type:"submit",children:"Sign Up"})]}),e.jsxs("p",{children:["Already have an account?"," ",e.jsx("span",{className:"link",onClick:()=>r("/login"),children:"Sign In"})]})]}),e.jsxs("div",{className:"signup-right",children:[e.jsx("h2",{children:"Welcome to Gator Shelfguide"}),e.jsx("p",{children:"Access a world of library resources with one account. Manage your library effortlessly, track your favorite books, and discover new opportunities!"}),e.jsx("button",{onClick:()=>r("/login"),children:"Sign In Instead"})]})]})})},{Header:ye}=B;function be(){return e.jsx(ye,{style:{background:"#fff",padding:"0 24px",display:"flex",justifyContent:"flex-end",alignItems:"center"},children:e.jsx(de,{menu:{items:[{key:"profile",label:"Personal center"},{key:"logout",label:"Logout"}]},children:e.jsxs(ue,{style:{cursor:"pointer"},children:[e.jsx(K,{icon:e.jsx(I,{})}),e.jsx("span",{children:"Admin"}),e.jsx(Z,{})]})})})}const{Sider:we}=B,q=[{key:"/main/dashboard",icon:e.jsx(V,{}),label:"Main page"},{key:"/main/books",icon:e.jsx(L,{}),label:"Book Management"},{key:"/main/users",icon:e.jsx(I,{}),label:"User Center"},{key:"/main/reports",icon:e.jsx(X,{}),label:"Search"}];function ve(){const r=P(),a=G(),c=()=>{var i;const o=a.pathname.split("/").slice(0,3).join("/");return((i=q.find(l=>l.key===o))==null?void 0:i.key)||""};return e.jsxs(we,{theme:"light",collapsible:!0,breakpoint:"lg",width:220,children:[e.jsx("div",{className:"logo",style:{height:64,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:"bold"},children:"Library"}),e.jsx(he,{mode:"inline",selectedKeys:[c()],items:q,onSelect:({key:o})=>r(o)})]})}const{Content:Se}=B,ke=()=>{const r=P(),a=G();return d.useEffect(()=>{!localStorage.getItem("isLoggedIn")&&!a.pathname.startsWith("/login")&&r("/login",{replace:!0,state:{from:a}})},[r,a]),e.jsxs(B,{style:{minHeight:"100vh",minWidth:"100vw",background:"#f0f2f5"},children:[e.jsx(ve,{}),e.jsxs(B,{children:[e.jsx(be,{}),e.jsx(Se,{style:{margin:"24px 16px",padding:24,minHeight:280,background:"#fff",borderRadius:8},children:e.jsx(ee,{})})]})]})},{Title:Ie,Paragraph:Ce}=ge;function Re(){return e.jsx("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:e.jsxs("div",{children:[e.jsx(te,{style:{fontSize:64,color:"#1890ff"}}),e.jsx(Ie,{level:2,style:{margin:"24px 0"},children:"Welcome to Library Management System"}),e.jsx(Ce,{type:"secondary",children:"Please use the navigation menu to get started"})]})})}const b=k.create({baseURL:"http://localhost:3000",timeout:1e4,headers:{"Content-Type":"application/json"}});b.interceptors.request.use(r=>{const a=localStorage.getItem("authToken");return a&&(r.headers.Authorization=`Bearer ${a}`),r});b.interceptors.response.use(r=>r.data,r=>{var a,c,o;return((a=r.response)==null?void 0:a.status)===401&&(localStorage.removeItem("authToken"),window.location.href="/login"),Promise.reject(((o=(c=r.response)==null?void 0:c.data)==null?void 0:o.message)||"requset failure")});const O={getBooks:async r=>b.get("/books",{params:{search:r}}),borrowBook:async r=>b.post("/borrow",{bookId:r}),returnBook:async r=>b.post("/borrow/return",{bookId:r}),addBook:async r=>b.post("/books",r),updateBook:async(r,a)=>b.put(`/books/${r}`,a)};function Be(){const[r,a]=d.useState([]),[c,o]=d.useState(""),[i,l]=d.useState(!1),[u,m]=d.useState({current:1,pageSize:8,total:0}),h=async()=>{try{l(!0);const t=encodeURIComponent(c),s=await O.getBooks({title:t,_page:u.current,_limit:u.pageSize}),x=Array.isArray(s==null?void 0:s.data)?s.data:Array.isArray(s)?s:[];console.log("[DEBUG] Processed data:",x),a(x),m(f=>{var y;return{...f,total:Number((y=s.headers)==null?void 0:y["x-total-count"])||s.total||x.length}})}catch(t){console.error("Data loading failed:",t),j.error(t.message),a([]),m(s=>({...s,total:0}))}finally{l(!1)}};d.useEffect(()=>{h()},[u.current]);const w=()=>{m(t=>({...t,current:1})),h()},g=(t,s)=>{J.confirm({title:`Confirm to ${t==="borrow"?"borrow":"return"} "${s.title}"?`,onOk:async()=>{try{l(!0),t==="borrow"?await O.borrowBook(s.id):await O.returnBook(s.id),j.success("Operation successful"),await h()}catch(x){j.error(x.message)}finally{l(!1)}}})},n=[{title:"Title",dataIndex:"title",key:"title",sorter:(t,s)=>t.title.localeCompare(s.title)},{title:"Author",dataIndex:"author",key:"author",sorter:(t,s)=>t.author.localeCompare(s.author)},{title:"ISBN",dataIndex:"isbn",key:"isbn",render:t=>t||e.jsx("span",{style:{color:"#bfbfbf"},children:"N/A"})},{title:"Available Copies",dataIndex:"available_copies",key:"available_copies",sorter:(t,s)=>t.available_copies-s.available_copies,render:t=>e.jsx("span",{style:{fontWeight:600,color:t>0?"#389e0d":"#cf1322"},children:t})},{title:"Status",render:(t,s)=>e.jsx("span",{style:{color:s.available_copies>0?"#52c41a":"#ff4d4f",fontWeight:500},children:s.available_copies>0?"Available":"Out of Stock"})},{title:"Action",render:(t,s)=>e.jsxs("div",{className:"action-buttons",children:[e.jsx(N,{type:"primary",onClick:()=>g("borrow",s),disabled:s.available_copies<=0,style:{minWidth:80},children:s.available_copies>0?"Borrow":"Unavailable"}),e.jsx(N,{type:"default",danger:!0,onClick:()=>g("return",s),style:{marginLeft:8,minWidth:80},children:"Return"})]})}];return e.jsxs("div",{className:"book-management",style:{padding:24},children:[e.jsx("h2",{style:{marginBottom:24},children:"ðŸ“š Book Management System"}),e.jsx("div",{className:"search-bar",style:{marginBottom:16},children:e.jsx(U.Search,{placeholder:"Search by title/author/ISBN...",allowClear:!0,enterButton:"Search",size:"large",onSearch:w,onChange:t=>o(t.target.value),onPressEnter:w,style:{maxWidth:600}})}),e.jsx(Y,{columns:n,dataSource:r,rowKey:"id",loading:i,pagination:{...u,showSizeChanger:!1,showTotal:t=>`Total ${t} books`,onChange:t=>m(s=>({...s,current:t}))},bordered:!0,scroll:{x:1e3},locale:{emptyText:e.jsxs("div",{style:{padding:40,textAlign:"center"},children:[e.jsx("img",{src:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",alt:"empty",style:{width:80,marginBottom:16}}),e.jsx("p",{style:{color:"rgba(0,0,0,0.25)"},children:"No Data"})]})}})]})}const Ne=e.jsx(se,{style:{fontSize:24},spin:!0});function De(){const[r,a]=d.useState([]),[c,o]=d.useState(null),[i,l]=d.useState(!0),[u,m]=d.useState(null);d.useEffect(()=>{(async()=>{try{const t=await b.get("/users/me");o({...t,createdAt:new Date(t.createdAt)});const s=await b.get("/borrow",{params:{userId:t.id}});a(h(s))}catch(t){m(t.message),j.error("Failed to load data")}finally{l(!1)}})()},[]);const h=n=>n.map(t=>({key:t.id,id:t.id,book:{id:t.book.id,title:t.book.title,author:t.book.author,isbn:t.book.isbn},borrowDate:new Date(t.borrowDate).toLocaleDateString(),dueDate:new Date(t.dueDate).toLocaleDateString(),returned:t.status==="RETURNED"})),w=async n=>{J.confirm({title:`Confirm return "${n.book.title}"?`,content:"Please ensure the book is in good condition",async onOk(){try{await b.post("/borrow/return",{bookId:n.book.id,userId:c.id}),a(t=>t.map(s=>s.id===n.id?{...s,returned:!0}:s)),j.success("Book returned successfully")}catch(t){j.error(t||"Return failed")}}})},g=[{title:"Book Information",dataIndex:"book",render:n=>e.jsxs("div",{className:"book-info",children:[e.jsx("h4",{children:n.title}),e.jsxs("div",{className:"meta",children:[e.jsx(v,{icon:e.jsx(I,{}),color:"blue",children:n.author}),e.jsxs(v,{icon:e.jsx(L,{}),children:["ISBN: ",n.isbn]})]})]})},{title:"Borrow Date",dataIndex:"borrowDate",sorter:(n,t)=>new Date(n.borrowDate)-new Date(t.borrowDate)},{title:"Due Date",dataIndex:"dueDate",render:(n,t)=>e.jsx("span",{style:{color:new Date(t.dueDate)<new Date?"#ff4d4f":"#389e0d",fontWeight:500},children:n})},{title:"Status",render:n=>e.jsx(v,{color:n.returned?"default":"success",children:n.returned?"Returned":"Borrowing"})},{title:"Action",render:n=>!n.returned&&e.jsx(N,{type:"primary",ghost:!0,onClick:()=>w(n),disabled:i,children:"Return"})}];return u?e.jsx(me,{type:"error",message:"Loading Error",description:u,showIcon:!0,style:{margin:24}}):e.jsx("div",{style:{padding:24},children:e.jsxs(Q,{spinning:i,indicator:Ne,children:[e.jsx(S,{title:e.jsxs(e.Fragment,{children:[e.jsx(I,{})," User Profile"]}),style:{marginBottom:24},children:c&&e.jsxs("div",{className:"user-info",children:[e.jsx("h3",{children:c.username}),e.jsx(v,{color:c.role==="ADMIN"?"gold":"blue",children:c.role.toLowerCase()}),e.jsx("div",{style:{marginTop:8},children:e.jsxs(v,{color:"geekblue",children:["Registered: ",c.createdAt.toLocaleDateString()]})})]})}),e.jsx(S,{title:e.jsxs(e.Fragment,{children:[e.jsx(L,{})," Borrowing History"]}),children:e.jsx(Y,{columns:g,dataSource:r,rowKey:"id",pagination:{pageSize:5,showTotal:n=>`Total ${n} records`},locale:{emptyText:e.jsx("div",{style:{padding:40,textAlign:"center"},children:e.jsx("p",{style:{color:"rgba(0,0,0,0.25)"},children:"No borrowing records found"})})}})})]})})}function Ae(){const[r]=R.useForm(),[a,c]=d.useState(""),[o,i]=d.useState(null),[l,u]=d.useState([]),[m,h]=d.useState(!1),[w,g]=d.useState(!1),n=async()=>{var s,x;if(!a.trim()){j.warning("Please enter a book title");return}try{g(!0);const f=await k.get(`/books?search=${encodeURIComponent(a)}`);if(f.data.length===0)throw new Error("No books found");const y=f.data[0],[M,D]=await Promise.all([k.get(`/books/${y.id}`),k.get(`/reviews?bookId=${y.id}`)]),A=D.data.filter(C=>{var _,z;return((_=C.content)==null?void 0:_.trim())&&((z=C.user)==null?void 0:z.username)});i(M.data),u(A)}catch(f){j.error(((x=(s=f.response)==null?void 0:s.data)==null?void 0:x.message)||f.message),i(null),u([])}finally{g(!1)}},t=async s=>{var x,f;if(o)try{const y=localStorage.getItem("token");if(!y){j.error("Please login to submit review");return}await k.post("/reviews",{bookId:o.id,rating:s.rating,comment:s.content},{headers:{Authorization:`Bearer ${y}`}});const{data:M}=await k.get(`/reviews?bookId=${o.id}`);u(M.filter(D=>{var A,C;return((A=D.content)==null?void 0:A.trim())&&((C=D.user)==null?void 0:C.username)})),r.resetFields(),j.success("Review submitted!")}catch(y){j.error(((f=(x=y.response)==null?void 0:x.data)==null?void 0:f.message)||"Submission failed")}};return e.jsxs("div",{style:{padding:24,maxWidth:1200,margin:"0 auto"},children:[e.jsx(S,{title:e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsx(U,{placeholder:"Search book by title...",prefix:e.jsx(re,{}),value:a,onChange:s=>c(s.target.value),style:{width:400},onPressEnter:n}),e.jsx(N,{type:"primary",loading:w,onClick:n,children:"Search"})]}),bordered:!1}),o?e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsxs(F,{gutter:24,children:[e.jsx($,{xs:24,md:8,children:e.jsx("img",{src:o.cover,alt:"Book Cover",style:{width:"100%",borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}})}),e.jsxs($,{xs:24,md:16,children:[e.jsx("h1",{style:{fontSize:28,marginBottom:8},children:o.title}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs(v,{icon:e.jsx(I,{}),color:"blue",children:["Author: ",o.author]}),e.jsxs(v,{icon:e.jsx(L,{}),color:"geekblue",children:["ISBN: ",o.isbn]}),e.jsxs(v,{color:o.available_copies>0?"green":"red",children:["Available: ",o.available_copies]})]}),e.jsx(F,{gutter:16,children:e.jsx($,{children:e.jsx(xe,{title:"Average Rating",value:o.averageRating,precision:1,prefix:e.jsx(ae,{style:{color:"#fadb14"}})})})}),e.jsx(W,{}),e.jsx("h3",{children:"Book Description"}),e.jsx("p",{style:{color:"rgba(0,0,0,0.7)",lineHeight:1.8},children:o.description||"No description available"})]})]})}),e.jsx(W,{}),e.jsx(S,{title:"Write a Review",children:e.jsxs(R,{form:r,onFinish:t,children:[e.jsx(R.Item,{name:"rating",label:"Rating",rules:[{required:!0}],children:e.jsx(H,{allowHalf:!0})}),e.jsx(R.Item,{name:"content",label:"Review Content",rules:[{required:!0},{max:500}],children:e.jsx(U.TextArea,{rows:4,placeholder:"Share your thoughts...",showCount:!0,maxLength:500})}),e.jsx(R.Item,{children:e.jsx(N,{type:"primary",htmlType:"submit",children:"Submit Review"})})]})}),e.jsx(S,{title:`Reviews (${l.length})`,children:l.length>0?e.jsx(E,{itemLayout:"vertical",dataSource:l,renderItem:s=>e.jsx(E.Item,{children:e.jsx(E.Item.Meta,{avatar:e.jsx(K,{icon:e.jsx(I,{})}),title:e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{fontWeight:500},children:s.user.username}),e.jsx(H,{disabled:!0,value:s.rating,style:{fontSize:14,marginLeft:16}})]}),description:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:s.comment}),e.jsx("span",{style:{color:"rgba(0,0,0,0.45)"},children:oe(s.createdAt).format("MMM D, YYYY HH:mm")})]})})})}):e.jsx("div",{style:{textAlign:"center",padding:24,color:"rgba(0,0,0,0.45)"},children:"No reviews yet. Be the first to share your thoughts!"})})]}):e.jsx(S,{style:{marginTop:24,textAlign:"center"},children:e.jsx("div",{style:{color:"rgba(0,0,0,0.45)",padding:40},children:w?e.jsx(Q,{size:"large"}):"Search for a book to view details"})})]})}function Le(){return e.jsxs(ne,{children:[e.jsx(p,{path:"/",element:e.jsx(T,{to:"/login",replace:!0})}),e.jsx(p,{path:"/login",element:e.jsx(je,{})}),e.jsx(p,{path:"/signup",element:e.jsx(fe,{})}),e.jsx(p,{path:"/admin",element:e.jsx(pe,{})}),e.jsxs(p,{path:"/main",element:e.jsx(ke,{}),children:[e.jsx(p,{index:!0,element:e.jsx(T,{to:"dashboard",replace:!0})}),e.jsx(p,{path:"dashboard",element:e.jsx(Re,{})}),e.jsx(p,{path:"books",element:e.jsx(Be,{})}),e.jsx(p,{path:"users",element:e.jsx(De,{})}),e.jsx(p,{path:"reports",element:e.jsx(Ae,{})})]}),e.jsx(p,{path:"*",element:e.jsx(T,{to:"/login",replace:!0})})]})}ie.createRoot(document.getElementById("root")).render(e.jsx(le.StrictMode,{children:e.jsx(ce,{children:e.jsx(Le,{})})}));
